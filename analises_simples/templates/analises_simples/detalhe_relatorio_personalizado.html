<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{{ titulo }}</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; margin: 20px; }
        .container { max-width: 900px; margin: auto; }
        h1, h2 { border-bottom: 2px solid #eee; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f9f9f9; }
        .destaque-ruim { color: #dc3545; font-weight: bold; }
        .destaque-bom { color: #28a745; font-weight: bold; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>
    <div class="container">
        <a href="{% url 'dashboard_analises' %}" class="no-print">&larr; Voltar ao Dashboard</a>
        <h1>{{ titulo }}</h1>
        <p>Executado em: {{ relatorio.timestamp_inicio }}</p>

        <h2>Resumo da Execução</h2>
        <ul>
            <li><strong>Tabela Analisada:</strong> {{ relatorio.tabela_analisada }}</li>
            <li><strong>Colunas Combinadas (Chave):</strong> {{ relatorio.colunas_combinadas }}</li>
            <li><strong>Total de Registros:</strong> {{ relatorio.total_registros }}</li>
            <li><strong>Registros Únicos:</strong> {{ relatorio.registros_unicos }}</li>
            <li><strong>Registros Duplicados:</strong> <span class="destaque-ruim">{{ relatorio.registros_duplicados }}</span></li>
            <li><strong>Percentual de Unicidade:</strong> {{ relatorio.percentual_unicidade|floatformat:2 }}%</li>
        </ul>

        <h2>Top 20 Duplicatas Encontradas</h2>
        {% if exemplos %}
            <table>
                <thead>
                    <tr>
                        <th>Valores da Combinação (Chave)</th>
                        <th>Nº de Repetições</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exemplo in exemplos %}
                        <tr>
                            <td>
                                {% for chave, valor in exemplo.valores.items %}
                                    <strong>{{ chave }}:</strong> {{ valor }}<br>
                                {% endfor %}
                            </td>
                            <td class="destaque-ruim">{{ exemplo.repeticoes }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="destaque-bom">Nenhuma duplicata encontrada! Os dados são únicos para essa combinação.</p>
        {% endif %}
    </div>
</body>
</html>